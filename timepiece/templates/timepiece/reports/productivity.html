{% extends "timepiece/reports/base.html" %}

{% load bootstrap_toolkit %}
{% load static %}
{% load timepiece_tags %}
{% load humanize %}

{% block title %}Productivity Report{% endblock title %}

{% block bodyid %}productivity-report{% endblock bodyid %}

{% block crumbs %}
    {{ block.super }}
    <li>
        <span class="divider">/</span>
        <a href="{% url 'report_productivity' %}">Productivity Report</a>
    </li>
{% endblock crumbs %}

{% block report_nav %}
    {% with 'productivity_report' as active %}
        {{ block.super }}
    {% endwith %}
{% endblock report_nav %}

{% block extrajs %}
    {{ block.super }}
    <script charset="utf-8" src="https://www.google.com/jsapi"></script>
    <script charset="utf-8" src="{% static "timepiece/js/chart/productivity_chart.js" %}"
            data-report="{{ report }}" data-type="{{ type }}"></script>
{% endblock extrajs %}

{% block report_content %}
    <div class="row-fluid">
        <div class="span12">
            <form class="form-horizontal" action="" method="GET">
                {{ form|as_bootstrap:"horizontal" }}
                <button type="submit" class="btn btn-primary">Submit</button>
                <button type="submit" class="btn" name="export" value="True">Export as CSV</button>
            </form>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span6 offset3">
            {% if type %}
            <table id="productivity-summary" class="table table-bordered">
                <tr><th>Total Worked</th><td>{{ total_worked|floatformat:2|intcomma }} hours</td></tr>
                <tr><th>Total Assigned</th><td>{{ total_assigned|floatformat:2|intcomma }} hours</td></tr>
                <tr><th>Total Remaining</th><td>{{ total_remaining|floatformat:2|intcomma }} hours</td></tr>
            </table>
            {% endif %}
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            <div id="chart" class="chart"></div>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span12">
            {% if type %}
            <table id="productivity-details" class="table table-bordered">
                <tr>
                    <th>{{ type|capfirst }}</th>
                    <th>Worked Hours</th>
                    <th>Assigned Hours</th>
                    <th>Remaining Hours</th>
                </tr>
                {% for row in report_table %}
                <tr>
                    <td><a href="{{ row.url }}">{{ row.label }}</a></td>
                    <td>{{ row.worked }}</td>
                    <td>{{ row.assigned }}</td>
                    <td>{{ row.remaining }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </div>
    </div>
{% endblock report_content %}
