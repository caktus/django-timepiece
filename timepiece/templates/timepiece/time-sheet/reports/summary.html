{% extends 'timepiece/time-sheet/base.html' %}
{% load timepiece_tags %}

{% block title %}Payroll Summary{% endblock %}

{% block content %}


<h2>Reports</h2>
<ul class='header-actions-left'>
    <li>
        {% if perms.timepiece.view_entry_summary %}
            <a href='{% url hourly_report %}'>Hourly</a>
        {% endif %}
    </li>
    <li>
        {% if perms.timepiece.view_entry_summary %}
            <a href='{% url timepiece-summary %}'>General Ledger</a>
        {% endif %}
    </li>
    <li>
        Payroll Report        
    </li>
</ul>

{% date_filters "months" %}

<form method="get" action="" id="date-filter" accept-charset="utf-8">
    <ul id='ledger-date-fieldlist'>
        {{ form.as_ul }}
        <li>
            <input type='submit' name='submit' value='Update' id='id_date_form_submit_btn'/>
        </li>
        <li>
            <input type='button' name='clear' value='Clear' id='id_date_form_clear_btn'/>
        </li>
    </ul>
</form>

<div class="cal_wrapper" style='float: right;'>
    <div class="cal left"> {% show_cal from_date 1 %} </div>
    <div class="cal middle"> {% show_cal from_date 0 %} </div>
</div>


<h3>Weekly Summary</h3>
{% if weekly_totals %}
    <table class='project'>
        <tr class="header">
            <th class='name_col'>Name</th>
            {% for date in date_headers %}
                <th>{{date|date:"M/d"}}</th>
            {% endfor %}
            <th>Overtime</th>
        </tr>
        {% for name, hours in weekly_totals %}
            {% if name.0 != "Totals:" %}
                <tr class="{% cycle 'odd' 'even' %}">           
                    <th class='name_col'>{{name.1}} {{name.0}}</th>
                    {% for num in hours %}
                        <td class='hours' title='{{name.1}}'>{{num|default:""}}</td>
                    {% endfor %}
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    {% else %}
        <p>No entries found.</p>
{% endif %}

<h3>Hourly Summary</h3>

<table>
    <tr>
        <th>&nbsp;</th>
        <th colspan="2">Billable</th>
        <th colspan="2">Non-Billable</th>
        <th>Total Worked</th>
        <th style="text-align:right;">Paid Leave</th>
        <th>Grand Total</th>
    </tr>
    {% for name, hours, descs, all in monthly_totals %}
        <tr class="{% cycle 'odd' 'even' %}">           
            <th class='name_col'>{{name.1}} {{name.0}}</th>
            {% for num in hours|slice:"0:2" %}
                <td class="hours">{{num.0|default:""}}</td>
                <td class="hours">{% if num.1 %}({{num.1}}%){% endif %}</td>
            {% endfor %}
            <td class="hours">{{hours.2}}</td>
            <td class="hours" style="width: 200px;">
            {% for desc in descs %}
                {{desc.0}}:&nbsp;&nbsp;{{desc.1}}
            {% endfor %}
            </td>
            <td class="hours">{{all}}</td>
        </tr>
    {% endfor %}
</table>
{% endblock %}

